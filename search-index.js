crystal_doc_search_index_callback({"repository_name":"d4","body":"# d4.cr\n\n[![test](https://github.com/kojix2/d4.cr/actions/workflows/test.yml/badge.svg)](https://github.com/kojix2/d4.cr/actions/workflows/test.yml)\n[![Lines of Code](https://img.shields.io/endpoint?url=https%3A%2F%2Ftokei.kojix2.net%2Fbadge%2Fgithub%2Fkojix2%2Fd4.cr%2Flines)](https://tokei.kojix2.net/github/kojix2/d4.cr)\n![Static Badge](https://img.shields.io/badge/PURE-VIBE_CODING-magenta)\n\nCrystal bindings for the [D4 format](https://github.com/38/d4-format) - a fast and compact format for storing quantitative genomic data.\n\n## Installation\n\n### Prerequisites\n\nInstall the `d4binding` library on your system.\n\n### Add to your project\n\n```yaml\ndependencies:\n  d4:\n    github: kojix2/d4\n```\n\nRun `shards install`\n\n## Usage\n\n```crystal\nrequire \"d4\"\n```\n\n### Reading D4 files\n\n```crystal\nD4.open(\"data.d4\") do |d4|\n  puts d4.chromosomes\n\n  values = d4.values(\"chr1\", 1000_u32, 2000_u32)\n  puts \"Mean depth: #{values.sum / values.size}\"\n\n  d4.query(\"chr1\", 1000_u32, 2000_u32) do |interval|\n    puts \"#{interval.left}-#{interval.right}: #{interval.value}\"\n  end\n\n  intervals = d4.query(\"chr1\", 1000_u32, 2000_u32)\n  puts \"Found #{intervals.size} intervals\"\n\n  d4.query_iter(\"chr1\", 1000_u32, 2000_u32).each do |interval|\n    puts interval\n  end\nend\n```\n\n### Writing D4 files\n\n```crystal\nD4.writer(\"output.d4\") do |writer|\n  chromosomes = {\"chr1\" => 1000_u32, \"chr2\" => 2000_u32}\n  writer.set_chromosomes(chromosomes)\n\n  values = [1_i32, 2_i32, 3_i32, 4_i32, 5_i32]\n  writer.write_values(\"chr1\", 0_u32, values)\n\n  intervals = [\n    D4::Interval.new(100_u32, 200_u32, 10_i32),\n    D4::Interval.new(200_u32, 300_u32, 20_i32)\n  ]\n  writer.write_intervals(\"chr1\", intervals)\n\n  writer.write_dense_values(\"chr2\", 0_u32, [5_i32, 6_i32, 7_i32])\nend\n```\n\n### Working with intervals\n\n```crystal\ninterval = D4::Interval.new(100_u32, 200_u32, 42_i32)\nputs interval.length  # => 100\nputs interval         # => \"100-200:42\"\n\npositions = [100_u32, 200_u32, 300_u32]\nvalues = [1_i32, 2_i32, 3_i32]\nintervals = D4::File.create_intervals(positions, values)\n\ndense_intervals = D4::File.create_dense_intervals(100_u32, [1_i32, 2_i32, 3_i32])\n```\n\n### Building indices\n\n```crystal\nD4.build_index(\"data.d4\")\n```\n\n### Error handling\n\n```crystal\nbegin\n  D4.open(\"nonexistent.d4\") do |d4|\n    # This will raise D4::D4Error\n  end\nrescue D4::D4Error => e\n  puts \"D4 error: #{e.message}\"\nend\n\nD4.clear_errors\n```\n\n## API\n\n### Classes\n\n- `D4::File` - Main class for reading and writing D4 files\n- `D4::Writer` - Convenience class for creating D4 files\n- `D4::Interval` - Represents a genomic interval with a value\n- `D4::Metadata` - Contains chromosome and dictionary information\n- `D4::QueryIterator` - Memory-efficient iterator for querying intervals\n\n### Enums\n\n- `D4::DictType` - Dictionary types (SimpleRange, ValueMap)\n\n### Exceptions\n\n- `D4::D4Error` - D4-specific errors with detailed messages\n\n## Design\n\nThis implementation follows the same design principles as d4-nim:\n\n- Core functionality only (no BAM/CRAM processing)\n- Simple dependencies (only requires `d4binding` library, no htslib)\n- Memory efficient with proper cleanup of C resources\n- Type safe using Crystal's type system\n\n## Development\n\n1. Install the `d4binding` library\n2. Clone this repository\n3. Run `shards install`\n4. Run tests with `crystal spec`\n\n## License\n\nMIT License\n\n## Acknowledgments\n\n- [Hao Hou](https://github.com/38) - creator of the D4 format\n- [Brent Pedersen](https://github.com/brentp) - creator of d4-nim\n","program":{"html_id":"d4/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"d4","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"d4/D4","path":"D4.html","kind":"module","full_name":"D4","name":"D4","abstract":false,"locations":[{"filename":"src/d4.cr","line_number":48,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L48"},{"filename":"src/d4/file.cr","line_number":4,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L4"},{"filename":"src/d4/query.cr","line_number":3,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L3"},{"filename":"src/d4/types.cr","line_number":3,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L3"},{"filename":"src/d4/version.cr","line_number":1,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/version.cr#L1"},{"filename":"src/d4/writer.cr","line_number":3,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L3"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"{{ (`shards version /home/runner/work/d4.cr/d4.cr/src/d4`).chomp.stringify }}"}],"doc":"D4 format library for Crystal\n\nD4 is a format designed to store quantitative data associated with genomic intervals.\nIt provides efficient compression and fast random access for depth data and similar\ngenomic quantitative information.\n\n## Usage\n\n### Reading D4 files\n\n```\n# Open and read a D4 file\nD4::File.open(\"data.d4\") do |d4|\n  puts d4.chromosomes\n\n  # Get values for a region\n  values = d4.values(\"chr1\", 1000_u32, 2000_u32)\n  puts \"Mean depth: #{values.sum / values.size}\"\n\n  # Query intervals with a block\n  d4.query(\"chr1\", 1000_u32, 2000_u32) do |interval|\n    puts \"#{interval.left}-#{interval.right}: #{interval.value}\"\n  end\nend\n```\n\n### Writing D4 files\n\n```\n# Create a new D4 file\nD4::Writer.new(\"output.d4\") do |writer|\n  # Set up chromosomes\n  chromosomes = {\"chr1\" => 1000_u32, \"chr2\" => 2000_u32}\n  writer.set_chromosomes(chromosomes)\n\n  # Write values\n  values = [1, 2, 3, 4, 5]\n  writer.write_values(\"chr1\", 0_u32, values)\nend\n```","summary":"<p>D4 format library for Crystal</p>","class_methods":[{"html_id":"build_index(path:String)-class-method","name":"build_index","doc":"Build SFI index for a D4 file","summary":"<p>Build SFI index for a D4 file</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/d4.cr","line_number":75,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L75"},"def":{"name":"build_index","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"File.build_index(path)"},"external_var":false},{"html_id":"check_pointer(pointer:Pointer(Void),message:String)-class-method","name":"check_pointer","abstract":false,"args":[{"name":"pointer","external_name":"pointer","restriction":"::Pointer(Void)"},{"name":"message","external_name":"message","restriction":"String"}],"args_string":"(pointer : Pointer(Void), message : String)","args_html":"(pointer : Pointer(Void), message : String)","location":{"filename":"src/d4/types.cr","line_number":110,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L110"},"def":{"name":"check_pointer","args":[{"name":"pointer","external_name":"pointer","restriction":"::Pointer(Void)"},{"name":"message","external_name":"message","restriction":"String"}],"visibility":"Public","body":"if pointer.null?\n  raise(D4Error.new(message))\nend\npointer\n"},"external_var":false},{"html_id":"check_result(result:Int32,message:String)-class-method","name":"check_result","doc":"Helper methods for error checking","summary":"<p>Helper methods for error checking</p>","abstract":false,"args":[{"name":"result","external_name":"result","restriction":"Int32"},{"name":"message","external_name":"message","restriction":"String"}],"args_string":"(result : Int32, message : String)","args_html":"(result : Int32, message : String)","location":{"filename":"src/d4/types.cr","line_number":100,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L100"},"def":{"name":"check_result","args":[{"name":"result","external_name":"result","restriction":"Int32"},{"name":"message","external_name":"message","restriction":"String"}],"visibility":"Public","body":"if result < 0\n  raise(D4Error.new(message))\nend\nresult\n"},"external_var":false},{"html_id":"check_ssize_result(result:LibC::SSizeT,message:String)-class-method","name":"check_ssize_result","abstract":false,"args":[{"name":"result","external_name":"result","restriction":"LibC::SSizeT"},{"name":"message","external_name":"message","restriction":"String"}],"args_string":"(result : LibC::SSizeT, message : String)","args_html":"(result : LibC::SSizeT, message : String)","location":{"filename":"src/d4/types.cr","line_number":105,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L105"},"def":{"name":"check_ssize_result","args":[{"name":"result","external_name":"result","restriction":"LibC::SSizeT"},{"name":"message","external_name":"message","restriction":"String"}],"visibility":"Public","body":"if result < 0\n  raise(D4Error.new(message))\nend\nresult\n"},"external_var":false},{"html_id":"clear_errors-class-method","name":"clear_errors","doc":"Clear any D4 library errors","summary":"<p>Clear any D4 library errors</p>","abstract":false,"location":{"filename":"src/d4.cr","line_number":80,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L80"},"def":{"name":"clear_errors","visibility":"Public","body":"LibD4.d4_error_clear"},"external_var":false},{"html_id":"error_number-class-method","name":"error_number","doc":"Get the current D4 library error number","summary":"<p>Get the current D4 library error number</p>","abstract":false,"location":{"filename":"src/d4.cr","line_number":85,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L85"},"def":{"name":"error_number","visibility":"Public","body":"LibD4.d4_error_num"},"external_var":false},{"html_id":"open(path:String,mode:String=\"r\")-class-method","name":"open","doc":"Convenience method to open a D4 file for reading","summary":"<p>Convenience method to open a D4 file for reading</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"args_string":"(path : String, mode : String = \"r\")","args_html":"(path : String, mode : String = <span class=\"s\">&quot;r&quot;</span>)","location":{"filename":"src/d4.cr","line_number":50,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L50"},"def":{"name":"open","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"visibility":"Public","body":"File.open(path, mode)"},"external_var":false},{"html_id":"open(path:String,mode:String=\"r\",&block:File->T)forallT-class-method","name":"open","doc":"Convenience method to open a D4 file with a block","summary":"<p>Convenience method to open a D4 file with a block</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"args_string":"(path : String, mode : String = \"r\", &block : File -> T) forall T","args_html":"(path : String, mode : String = <span class=\"s\">&quot;r&quot;</span>, &block : <a href=\"D4/File.html\">File</a> -> T) forall T","location":{"filename":"src/d4.cr","line_number":55,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L55"},"def":{"name":"open","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(File -> T)"},"visibility":"Public","body":"File.open(path, mode, &block)"},"external_var":false},{"html_id":"writer(path:String)-class-method","name":"writer","doc":"Create a new D4 writer","summary":"<p>Create a new D4 writer</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/d4.cr","line_number":60,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L60"},"def":{"name":"writer","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"Writer.new(path)"},"external_var":false},{"html_id":"writer(path:String,&block:Writer->T)forallT-class-method","name":"writer","doc":"Create a new D4 writer with a block","summary":"<p>Create a new D4 writer with a block</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String, &block : Writer -> T) forall T","args_html":"(path : String, &block : <a href=\"D4/Writer.html\">Writer</a> -> T) forall T","location":{"filename":"src/d4.cr","line_number":65,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4.cr#L65"},"def":{"name":"writer","args":[{"name":"path","external_name":"path","restriction":"String"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Writer -> T)"},"visibility":"Public","body":"writer = Writer.new(path)\nbegin\n  yield writer\nensure\n  if writer.closed?\n  else\n    writer.close\n  end\nend\n"},"external_var":false}],"types":[{"html_id":"d4/D4/D4Error","path":"D4/D4Error.html","kind":"class","full_name":"D4::D4Error","name":"D4Error","abstract":false,"superclass":{"html_id":"d4/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"d4/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/types.cr","line_number":5,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L5"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"D4 specific exception","summary":"<p>D4 specific exception</p>","constructors":[{"html_id":"new(message:String|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"message","default_value":"nil","external_name":"message","restriction":"String | ::Nil"}],"args_string":"(message : String | Nil = nil)","args_html":"(message : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/d4/types.cr","line_number":6,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L6"},"def":{"name":"new","args":[{"name":"message","default_value":"nil","external_name":"message","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(message)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}]},{"html_id":"d4/D4/DictType","path":"D4/DictType.html","kind":"enum","full_name":"D4::DictType","name":"DictType","abstract":false,"ancestors":[{"html_id":"d4/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"d4/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"d4/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/types.cr","line_number":45,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L45"}],"repository_name":"d4","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"SimpleRange","name":"SimpleRange","value":"0"},{"id":"ValueMap","name":"ValueMap","value":"1"}],"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Dictionary types for D4 files","summary":"<p>Dictionary types for D4 files</p>","class_methods":[{"html_id":"from_lib_dict_type(lib_type:LibD4::DictType)-class-method","name":"from_lib_dict_type","abstract":false,"args":[{"name":"lib_type","external_name":"lib_type","restriction":"LibD4::DictType"}],"args_string":"(lib_type : LibD4::DictType)","args_html":"(lib_type : LibD4::DictType)","location":{"filename":"src/d4/types.cr","line_number":56,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L56"},"def":{"name":"from_lib_dict_type","args":[{"name":"lib_type","external_name":"lib_type","restriction":"LibD4::DictType"}],"visibility":"Public","body":"case lib_type\nin .simple_range?\n  SimpleRange\nin .value_map?\n  ValueMap\nend"},"external_var":false}],"instance_methods":[{"html_id":"simple_range?-instance-method","name":"simple_range?","doc":"Returns `true` if this enum value equals `SimpleRange`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../D4/DictType.html#SimpleRange\">SimpleRange</a></code></p>","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":46,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L46"},"def":{"name":"simple_range?","visibility":"Public","body":"self == SimpleRange"},"external_var":false},{"html_id":"to_lib_dict_type-instance-method","name":"to_lib_dict_type","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":49,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L49"},"def":{"name":"to_lib_dict_type","visibility":"Public","body":"case self\nin .simple_range?\n  LibD4::DictType::SimpleRange\nin .value_map?\n  LibD4::DictType::ValueMap\nend"},"external_var":false},{"html_id":"value_map?-instance-method","name":"value_map?","doc":"Returns `true` if this enum value equals `ValueMap`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../D4/DictType.html#ValueMap\">ValueMap</a></code></p>","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":47,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L47"},"def":{"name":"value_map?","visibility":"Public","body":"self == ValueMap"},"external_var":false}]},{"html_id":"d4/D4/File","path":"D4/File.html","kind":"class","full_name":"D4::File","name":"File","abstract":false,"superclass":{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/file.cr","line_number":6,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L6"},{"filename":"src/d4/query.cr","line_number":4,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L4"},{"filename":"src/d4/writer.cr","line_number":4,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L4"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Main class for D4 file operations","summary":"<p>Main class for D4 file operations</p>","class_methods":[{"html_id":"build_index(path:String)-class-method","name":"build_index","doc":"Build SFI index for the file","summary":"<p>Build SFI index for the file</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/d4/file.cr","line_number":206,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L206"},"def":{"name":"build_index","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"result = LibD4.d4_index_build_sfi(path)\nD4.check_result(result, \"Failed to build SFI index for #{path}\")\n"},"external_var":false},{"html_id":"create_dense_intervals(start_position:UInt32,values:Array(Int32)):Array(Interval)-class-method","name":"create_dense_intervals","doc":"Create intervals from dense values (each position gets one value)","summary":"<p>Create intervals from dense values (each position gets one value)</p>","abstract":false,"args":[{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(start_position : UInt32, values : Array(Int32)) : Array(Interval)","args_html":"(start_position : UInt32, values : Array(Int32)) : Array(<a href=\"../D4/Interval.html\">Interval</a>)","location":{"filename":"src/d4/writer.cr","line_number":117,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L117"},"def":{"name":"create_dense_intervals","args":[{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"return_type":"Array(Interval)","visibility":"Public","body":"intervals = Array(Interval).new\nvalues.each_with_index do |value, i|\n  pos = start_position + i.to_u32\n  intervals << (Interval.new(pos, pos + 1, value))\nend\nintervals\n"},"external_var":false},{"html_id":"create_intervals(positions:Array(UInt32),values:Array(Int32)):Array(Interval)-class-method","name":"create_intervals","doc":"Create intervals from position-value pairs","summary":"<p>Create intervals from position-value pairs</p>","abstract":false,"args":[{"name":"positions","external_name":"positions","restriction":"Array(UInt32)"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(positions : Array(UInt32), values : Array(Int32)) : Array(Interval)","args_html":"(positions : Array(UInt32), values : Array(Int32)) : Array(<a href=\"../D4/Interval.html\">Interval</a>)","location":{"filename":"src/d4/writer.cr","line_number":103,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L103"},"def":{"name":"create_intervals","args":[{"name":"positions","external_name":"positions","restriction":"Array(UInt32)"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"return_type":"Array(Interval)","visibility":"Public","body":"if positions.size != values.size\n  raise(ArgumentError.new(\"Positions and values arrays must have the same size\"))\nend\n\nintervals = Array(Interval).new\npositions.each_with_index do |pos, i|\n  next_pos = (i + 1) < positions.size ? positions[i + 1] : pos + 1\n  intervals << (Interval.new(pos, next_pos, values[i]))\nend\nintervals\n"},"external_var":false},{"html_id":"open(path:String,mode:String=\"r\")-class-method","name":"open","doc":"Open a D4 file","summary":"<p>Open a D4 file</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"args_string":"(path : String, mode : String = \"r\")","args_html":"(path : String, mode : String = <span class=\"s\">&quot;r&quot;</span>)","location":{"filename":"src/d4/file.cr","line_number":16,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L16"},"def":{"name":"open","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"visibility":"Public","body":"handle = LibD4.d4_open(path, mode)\nD4.check_pointer(handle.as(::Pointer(Void)), \"Failed to open D4 file: #{path}\")\nnew(handle)\n"},"external_var":false},{"html_id":"open(path:String,mode:String=\"r\",&block:File->T)forallT-class-method","name":"open","doc":"Open a D4 file with a block, automatically closes the file","summary":"<p>Open a D4 file with a block, automatically closes the file</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"args_string":"(path : String, mode : String = \"r\", &block : File -> T) forall T","args_html":"(path : String, mode : String = <span class=\"s\">&quot;r&quot;</span>, &block : <a href=\"../D4/File.html\">File</a> -> T) forall T","location":{"filename":"src/d4/file.cr","line_number":23,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L23"},"def":{"name":"open","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"mode","default_value":"\"r\"","external_name":"mode","restriction":"String"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(File -> T)"},"visibility":"Public","body":"file = open(path, mode)\nbegin\n  yield file\nensure\n  if file.closed?\n  else\n    file.close\n  end\nend\n"},"external_var":false}],"constructors":[{"html_id":"new(handle:LibD4::D4File)-class-method","name":"new","abstract":false,"args":[{"name":"handle","external_name":"handle","restriction":"LibD4::D4File"}],"args_string":"(handle : LibD4::D4File)","args_html":"(handle : LibD4::D4File)","location":{"filename":"src/d4/file.cr","line_number":11,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L11"},"def":{"name":"new","args":[{"name":"handle","external_name":"handle","restriction":"LibD4::D4File"}],"visibility":"Public","body":"_ = allocate\n_.initialize(handle)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"chromosome_size(name:String)-instance-method","name":"chromosome_size","doc":"Get chromosome size","summary":"<p>Get chromosome size</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"}],"args_string":"(name : String)","args_html":"(name : String)","location":{"filename":"src/d4/file.cr","line_number":123,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L123"},"def":{"name":"chromosome_size","args":[{"name":"name","external_name":"name","restriction":"String"}],"visibility":"Public","body":"metadata.chromosome_size(name)"},"external_var":false},{"html_id":"chromosomes-instance-method","name":"chromosomes","doc":"Get chromosome information","summary":"<p>Get chromosome information</p>","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":113,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L113"},"def":{"name":"chromosomes","visibility":"Public","body":"metadata.chromosomes"},"external_var":false},{"html_id":"close-instance-method","name":"close","doc":"Close the D4 file","summary":"<p>Close the D4 file</p>","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":33,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L33"},"def":{"name":"close","visibility":"Public","body":"if @closed\n  return\nend\nresult = LibD4.d4_close(@handle)\nD4.check_result(result, \"Failed to close D4 file\")\n@closed = true\n"},"external_var":false},{"html_id":"closed?:Bool-instance-method","name":"closed?","doc":"Check if the file is closed","summary":"<p>Check if the file is closed</p>","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":41,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L41"},"def":{"name":"closed?","visibility":"Public","body":"@closed"},"external_var":false},{"html_id":"finalize-instance-method","name":"finalize","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":232,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L232"},"def":{"name":"finalize","visibility":"Public","body":"if @closed\nelse\n  close\nend"},"external_var":false},{"html_id":"has_chromosome?(name:String)-instance-method","name":"has_chromosome?","doc":"Check if a chromosome exists","summary":"<p>Check if a chromosome exists</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"}],"args_string":"(name : String)","args_html":"(name : String)","location":{"filename":"src/d4/file.cr","line_number":118,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L118"},"def":{"name":"has_chromosome?","args":[{"name":"name","external_name":"name","restriction":"String"}],"visibility":"Public","body":"metadata.has_chromosome?(name)"},"external_var":false},{"html_id":"metadata:Metadata-instance-method","name":"metadata","doc":"Load metadata from the file","summary":"<p>Load metadata from the file</p>","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":96,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L96"},"def":{"name":"metadata","return_type":"Metadata","visibility":"Public","body":"if @metadata\n  return @metadata.not_nil!\nend\n\ncheck_not_closed\nlib_metadata = LibD4::FileMetadata.new\nresult = LibD4.d4_file_load_metadata(@handle, pointerof(lib_metadata))\nD4.check_result(result, \"Failed to load metadata\")\n\n@metadata = Metadata.new(lib_metadata)\n\n\ncleanup_lib_metadata(pointerof(lib_metadata))\n\n@metadata.not_nil!\n"},"external_var":false},{"html_id":"query(chromosome:String,start:UInt32=0_u32,stop:UInt32|Nil=nil,&block:Interval->Nil)-instance-method","name":"query","doc":"Query intervals in a specific region with an iterator","summary":"<p>Query intervals in a specific region with an iterator</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"args_string":"(chromosome : String, start : UInt32 = 0_u32, stop : UInt32 | Nil = nil, &block : Interval -> Nil)","args_html":"(chromosome : String, start : UInt32 = <span class=\"n\">0_u32</span>, stop : UInt32 | Nil = <span class=\"n\">nil</span>, &block : <a href=\"../D4/Interval.html\">Interval</a> -> Nil)","location":{"filename":"src/d4/query.cr","line_number":6,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L6"},"def":{"name":"query","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Interval -> Nil)"},"visibility":"Public","body":"check_not_closed\n\nif has_chromosome?(chromosome)\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nchrom_size = chromosome_size(chromosome)\nif chrom_size\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nactual_stop = stop || chrom_size\nactual_stop = Math.min(actual_stop, chrom_size)\n\nif start >= actual_stop\n  return\nend\n\nseek(chromosome, start)\nbuffer = Array(LibD4::Interval).new(1000) do LibD4::Interval.new end\ndone = false\nname_buffer = Bytes.new(256)\nposition = 0_u32\n\nwhile !done\n  result = LibD4.d4_file_tell(@handle, name_buffer.to_unsafe.as(::Pointer(LibC::Char)), name_buffer.size, pointerof(position))\n  D4.check_result(result, \"Failed to get current position during query\")\n\n\n  null_pos = (name_buffer.index(0_u8)) || name_buffer.size\n  current_chrom = String.new(name_buffer[0, null_pos])\n\n\n  if current_chrom != chromosome\n    break\n  end\n\n\n  count = LibD4.d4_file_read_intervals(@handle, buffer.to_unsafe, buffer.size.to_u64)\n  actual_count = D4.check_ssize_result(count, \"Failed to read intervals during query\")\n\n  actual_count.to_i.times do |i|\n    lib_interval = buffer[i]\n    interval = Interval.new(lib_interval)\n\n\n    filtered_left = Math.max(start, interval.left)\n    filtered_right = Math.min(actual_stop, interval.right)\n\n    if filtered_left < filtered_right\n      filtered_interval = Interval.new(filtered_left, filtered_right, interval.value)\n      yield filtered_interval\n    end\n\n\n    if interval.right >= actual_stop\n      done = true\n      break\n    end\n  end\n\n\n  if actual_count.to_i < buffer.size\n    break\n  end\nend\n"},"external_var":false},{"html_id":"query(chromosome:String,start:UInt32=0_u32,stop:UInt32|Nil=nil):Array(Interval)-instance-method","name":"query","doc":"Query intervals and return as an array","summary":"<p>Query intervals and return as an array</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"args_string":"(chromosome : String, start : UInt32 = 0_u32, stop : UInt32 | Nil = nil) : Array(Interval)","args_html":"(chromosome : String, start : UInt32 = <span class=\"n\">0_u32</span>, stop : UInt32 | Nil = <span class=\"n\">nil</span>) : Array(<a href=\"../D4/Interval.html\">Interval</a>)","location":{"filename":"src/d4/query.cr","line_number":73,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L73"},"def":{"name":"query","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"return_type":"Array(Interval)","visibility":"Public","body":"intervals = Array(Interval).new\nquery(chromosome, start, stop) do |interval|\n  intervals << interval\nend\nintervals\n"},"external_var":false},{"html_id":"query_iter(chromosome:String,start:UInt32=0_u32,stop:UInt32|Nil=nil)-instance-method","name":"query_iter","doc":"Query intervals and return an iterator","summary":"<p>Query intervals and return an iterator</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"args_string":"(chromosome : String, start : UInt32 = 0_u32, stop : UInt32 | Nil = nil)","args_html":"(chromosome : String, start : UInt32 = <span class=\"n\">0_u32</span>, stop : UInt32 | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/d4/query.cr","line_number":82,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L82"},"def":{"name":"query_iter","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"visibility":"Public","body":"QueryIterator.new(self, chromosome, start, stop)"},"external_var":false},{"html_id":"read_intervals(count:Int32):Array(Interval)-instance-method","name":"read_intervals","doc":"Read intervals from the current position","summary":"<p>Read intervals from the current position</p>","abstract":false,"args":[{"name":"count","external_name":"count","restriction":"Int32"}],"args_string":"(count : Int32) : Array(Interval)","args_html":"(count : Int32) : Array(<a href=\"../D4/Interval.html\">Interval</a>)","location":{"filename":"src/d4/file.cr","line_number":157,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L157"},"def":{"name":"read_intervals","args":[{"name":"count","external_name":"count","restriction":"Int32"}],"return_type":"Array(Interval)","visibility":"Public","body":"check_not_closed\nlib_intervals = Array(LibD4::Interval).new(count) do LibD4::Interval.new end\nresult = LibD4.d4_file_read_intervals(@handle, lib_intervals.to_unsafe, count.to_u64)\nactual_count = D4.check_ssize_result(result, \"Failed to read intervals\")\nintervals = Array(Interval).new(actual_count.to_i)\nactual_count.to_i.times do |i| intervals << (Interval.new(lib_intervals[i])) end\nintervals\n"},"external_var":false},{"html_id":"read_values(count:Int32):Array(Int32)-instance-method","name":"read_values","doc":"Read values from the current position","summary":"<p>Read values from the current position</p>","abstract":false,"args":[{"name":"count","external_name":"count","restriction":"Int32"}],"args_string":"(count : Int32) : Array(Int32)","args_html":"(count : Int32) : Array(Int32)","location":{"filename":"src/d4/file.cr","line_number":148,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L148"},"def":{"name":"read_values","args":[{"name":"count","external_name":"count","restriction":"Int32"}],"return_type":"Array(Int32)","visibility":"Public","body":"check_not_closed\nbuffer = Array(Int32).new(count, 0)\nresult = LibD4.d4_file_read_values(@handle, buffer.to_unsafe, count.to_u64)\nactual_count = D4.check_ssize_result(result, \"Failed to read values\")\nbuffer[0, actual_count.to_i]\n"},"external_var":false},{"html_id":"seek(chromosome:String,position:UInt32=0_u32)-instance-method","name":"seek","doc":"Seek to a specific position in a chromosome","summary":"<p>Seek to a specific position in a chromosome</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","default_value":"0_u32","external_name":"position","restriction":"UInt32"}],"args_string":"(chromosome : String, position : UInt32 = 0_u32)","args_html":"(chromosome : String, position : UInt32 = <span class=\"n\">0_u32</span>)","location":{"filename":"src/d4/file.cr","line_number":128,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L128"},"def":{"name":"seek","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","default_value":"0_u32","external_name":"position","restriction":"UInt32"}],"visibility":"Public","body":"check_not_closed\nresult = LibD4.d4_file_seek(@handle, chromosome, position)\nD4.check_result(result, \"Failed to seek to #{chromosome}:#{position}\")\nself\n"},"external_var":false},{"html_id":"set_chromosomes(chromosomes:Hash(String,UInt32),dict_type:DictType=DictType::SimpleRange,denominator:Float64=1.0)-instance-method","name":"set_chromosomes","doc":"Set chromosomes for a new D4 file (write mode)","summary":"<p>Set chromosomes for a new D4 file (write mode)</p>","abstract":false,"args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"args_string":"(chromosomes : Hash(String, UInt32), dict_type : DictType = DictType::SimpleRange, denominator : Float64 = 1.0)","args_html":"(chromosomes : Hash(String, UInt32), dict_type : <a href=\"../D4/DictType.html\">DictType</a> = <span class=\"t\">DictType</span><span class=\"t\">::</span><span class=\"t\">SimpleRange</span>, denominator : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/d4/writer.cr","line_number":6,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L6"},"def":{"name":"set_chromosomes","args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"visibility":"Public","body":"check_not_closed\n\nchrom_names = chromosomes.keys.to_a\nchrom_sizes = chromosomes.values.to_a\n\nname_count = chrom_names.size\n\n\nname_array = (LibC.malloc(name_count * (sizeof(Pointer(LibC::Char))))).as(::Pointer(::Pointer(LibC::Char)))\nsize_array = (LibC.malloc(name_count * (sizeof(UInt32)))).as(::Pointer(UInt32))\n\nallocated_strings = Array(::Pointer(LibC::Char)).new(name_count)\n\nbegin\n  name_count.times do |i|\n    s = chrom_names[i]\n    bytesize = s.bytesize\n    cstr = (LibC.malloc(bytesize + 1)).as(::Pointer(LibC::Char))\n\n    s.to_slice.copy_to(Slice.new(cstr, bytesize))\n    cstr[bytesize] = 0_u8\n    name_array[i] = cstr\n    allocated_strings << cstr\n    size_array[i] = chrom_sizes[i]\n  end\n\n  lib_metadata = LibD4::FileMetadata.new\n  lib_metadata.chrom_count = name_count.to_u64\n  lib_metadata.chrom_name = name_array\n  lib_metadata.chrom_size = size_array\n  lib_metadata.dict_type = dict_type.to_lib_dict_type\n  lib_metadata.denominator = denominator\n\n\n  case dict_type\n  in .simple_range?\n    lib_metadata.dict_data.simple_range.low = 0\n    lib_metadata.dict_data.simple_range.high = 128\n  in .value_map?\n    lib_metadata.dict_data.value_map.size = 0_u64\n    lib_metadata.dict_data.value_map.values = Pointer(Int32).null\n  end\n\n  result = LibD4.d4_file_update_metadata(@handle, pointerof(lib_metadata))\n  D4.check_result(result, \"Failed to update metadata\")\n\n  @metadata = Metadata.new(chromosomes, dict_type, denominator)\nrescue e\n  raise(e)\nensure\n  allocated_strings.each do |ptr|\n    if ptr.null?\n    else\n      LibC.free(ptr.as(::Pointer(Void)))\n    end\n  end\n  if name_array.null?\n  else\n    LibC.free(name_array.as(::Pointer(Void)))\n  end\n  if size_array.null?\n  else\n    LibC.free(size_array.as(::Pointer(Void)))\n  end\nend\n"},"external_var":false},{"html_id":"set_chromosomes(chromosomes:Array(Tuple(String,UInt32)),dict_type:DictType=DictType::SimpleRange,denominator:Float64=1.0)-instance-method","name":"set_chromosomes","doc":"Set chromosomes from an array of tuples","summary":"<p>Set chromosomes from an array of tuples</p>","abstract":false,"args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Array(Tuple(String, UInt32))"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"args_string":"(chromosomes : Array(Tuple(String, UInt32)), dict_type : DictType = DictType::SimpleRange, denominator : Float64 = 1.0)","args_html":"(chromosomes : Array(Tuple(String, UInt32)), dict_type : <a href=\"../D4/DictType.html\">DictType</a> = <span class=\"t\">DictType</span><span class=\"t\">::</span><span class=\"t\">SimpleRange</span>, denominator : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/d4/writer.cr","line_number":70,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L70"},"def":{"name":"set_chromosomes","args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Array(Tuple(String, UInt32))"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"visibility":"Public","body":"chrom_hash = Hash(String, UInt32).new\nchromosomes.each do |name, size|\n  chrom_hash[name] = size\nend\nset_chromosomes(chrom_hash, dict_type, denominator)\n"},"external_var":false},{"html_id":"tell-instance-method","name":"tell","doc":"Get current position","summary":"<p>Get current position</p>","abstract":false,"location":{"filename":"src/d4/file.cr","line_number":136,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L136"},"def":{"name":"tell","visibility":"Public","body":"check_not_closed\nname_buffer = Bytes.new(256)\nposition = 0_u32\nresult = LibD4.d4_file_tell(@handle, name_buffer.to_unsafe.as(::Pointer(LibC::Char)), name_buffer.size, pointerof(position))\nD4.check_result(result, \"Failed to get current position\")\nnull_pos = (name_buffer.index(0_u8)) || name_buffer.size\nchromosome = String.new(name_buffer[0, null_pos])\n{chromosome, position}\n"},"external_var":false},{"html_id":"values(chromosome:String,start:UInt32=0_u32,stop:UInt32|Nil=nil):Array(Int32)-instance-method","name":"values","doc":"Get values for a specific region","summary":"<p>Get values for a specific region</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"args_string":"(chromosome : String, start : UInt32 = 0_u32, stop : UInt32 | Nil = nil) : Array(Int32)","args_html":"(chromosome : String, start : UInt32 = <span class=\"n\">0_u32</span>, stop : UInt32 | Nil = <span class=\"n\">nil</span>) : Array(Int32)","location":{"filename":"src/d4/file.cr","line_number":185,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L185"},"def":{"name":"values","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","default_value":"0_u32","external_name":"start","restriction":"UInt32"},{"name":"stop","default_value":"nil","external_name":"stop","restriction":"UInt32 | ::Nil"}],"return_type":"Array(Int32)","visibility":"Public","body":"check_not_closed\n\nif has_chromosome?(chromosome)\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nchrom_size = chromosome_size(chromosome)\nif chrom_size\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nactual_stop = stop || chrom_size\nactual_stop = Math.min(actual_stop, chrom_size)\n\nif start >= actual_stop\n  return Array(Int32).new\nend\n\nseek(chromosome, start)\ncount = (actual_stop - start).to_i\nread_values(count)\n"},"external_var":false},{"html_id":"write_dense_values(chromosome:String,start_position:UInt32,values:Array(Int32))-instance-method","name":"write_dense_values","doc":"Convenience method to write dense values as intervals","summary":"<p>Convenience method to write dense values as intervals</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(chromosome : String, start_position : UInt32, values : Array(Int32))","args_html":"(chromosome : String, start_position : UInt32, values : Array(Int32))","location":{"filename":"src/d4/writer.cr","line_number":127,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L127"},"def":{"name":"write_dense_values","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"visibility":"Public","body":"intervals = File.create_dense_intervals(start_position, values)\nwrite_intervals(chromosome, intervals)\n"},"external_var":false},{"html_id":"write_intervals(chromosome:String,intervals:Array(Interval))-instance-method","name":"write_intervals","doc":"Write intervals to a specific chromosome","summary":"<p>Write intervals to a specific chromosome</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"args_string":"(chromosome : String, intervals : Array(Interval))","args_html":"(chromosome : String, intervals : Array(<a href=\"../D4/Interval.html\">Interval</a>))","location":{"filename":"src/d4/writer.cr","line_number":91,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L91"},"def":{"name":"write_intervals","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"visibility":"Public","body":"check_not_closed\n\nif has_chromosome?(chromosome)\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nseek(chromosome, 0_u32)\nwrite_intervals(intervals)\n"},"external_var":false},{"html_id":"write_intervals(intervals:Array(Interval))-instance-method","name":"write_intervals","doc":"Write intervals to the current position","summary":"<p>Write intervals to the current position</p>","abstract":false,"args":[{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"args_string":"(intervals : Array(Interval))","args_html":"(intervals : Array(<a href=\"../D4/Interval.html\">Interval</a>))","location":{"filename":"src/d4/file.cr","line_number":176,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L176"},"def":{"name":"write_intervals","args":[{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"visibility":"Public","body":"check_not_closed\nlib_intervals = intervals.map(&.to_lib_interval)\nresult = LibD4.d4_file_write_intervals(@handle, lib_intervals.to_unsafe, intervals.size.to_u64)\nD4.check_ssize_result(result, \"Failed to write intervals\")\nintervals.size\n"},"external_var":false},{"html_id":"write_values(chromosome:String,position:UInt32,values:Array(Int32))-instance-method","name":"write_values","doc":"Write values to a specific chromosome starting at a position","summary":"<p>Write values to a specific chromosome starting at a position</p>","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","external_name":"position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(chromosome : String, position : UInt32, values : Array(Int32))","args_html":"(chromosome : String, position : UInt32, values : Array(Int32))","location":{"filename":"src/d4/writer.cr","line_number":79,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L79"},"def":{"name":"write_values","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","external_name":"position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"visibility":"Public","body":"check_not_closed\n\nif has_chromosome?(chromosome)\nelse\n  raise(D4Error.new(\"Chromosome '#{chromosome}' not found\"))\nend\n\nseek(chromosome, position)\nwrite_values(values)\n"},"external_var":false},{"html_id":"write_values(values:Array(Int32))-instance-method","name":"write_values","doc":"Write values to the current position","summary":"<p>Write values to the current position</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(values : Array(Int32))","args_html":"(values : Array(Int32))","location":{"filename":"src/d4/file.cr","line_number":168,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/file.cr#L168"},"def":{"name":"write_values","args":[{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"visibility":"Public","body":"check_not_closed\nresult = LibD4.d4_file_write_values(@handle, values.to_unsafe, values.size.to_u64)\nD4.check_ssize_result(result, \"Failed to write values\")\nvalues.size\n"},"external_var":false}]},{"html_id":"d4/D4/Interval","path":"D4/Interval.html","kind":"struct","full_name":"D4::Interval","name":"Interval","abstract":false,"superclass":{"html_id":"d4/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"d4/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"d4/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/types.cr","line_number":18,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L18"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Represents a genomic interval with a value","summary":"<p>Represents a genomic interval with a value</p>","constructors":[{"html_id":"new(left:UInt32,right:UInt32,value:Int32)-class-method","name":"new","abstract":false,"args":[{"name":"left","external_name":"left","restriction":"UInt32"},{"name":"right","external_name":"right","restriction":"UInt32"},{"name":"value","external_name":"value","restriction":"Int32"}],"args_string":"(left : UInt32, right : UInt32, value : Int32)","args_html":"(left : UInt32, right : UInt32, value : Int32)","location":{"filename":"src/d4/types.cr","line_number":23,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L23"},"def":{"name":"new","args":[{"name":"left","external_name":"left","restriction":"UInt32"},{"name":"right","external_name":"right","restriction":"UInt32"},{"name":"value","external_name":"value","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(left, right, value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(lib_interval:LibD4::Interval)-class-method","name":"new","abstract":false,"args":[{"name":"lib_interval","external_name":"lib_interval","restriction":"LibD4::Interval"}],"args_string":"(lib_interval : LibD4::Interval)","args_html":"(lib_interval : LibD4::Interval)","location":{"filename":"src/d4/types.cr","line_number":25,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L25"},"def":{"name":"new","args":[{"name":"lib_interval","external_name":"lib_interval","restriction":"LibD4::Interval"}],"visibility":"Public","body":"_ = allocate\n_.initialize(lib_interval)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"left:UInt32-instance-method","name":"left","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":19,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L19"},"def":{"name":"left","return_type":"UInt32","visibility":"Public","body":"@left"},"external_var":false},{"html_id":"length-instance-method","name":"length","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":35,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L35"},"def":{"name":"length","visibility":"Public","body":"@right - @left"},"external_var":false},{"html_id":"right:UInt32-instance-method","name":"right","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":20,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L20"},"def":{"name":"right","return_type":"UInt32","visibility":"Public","body":"@right"},"external_var":false},{"html_id":"to_lib_interval-instance-method","name":"to_lib_interval","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":31,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L31"},"def":{"name":"to_lib_interval","visibility":"Public","body":"LibD4::Interval.new(left: @left, right: @right, value: @value)"},"external_var":false},{"html_id":"to_s(io:IO):Nil-instance-method","name":"to_s","doc":"Same as `#inspect(io)`.","summary":"<p>Same as <code>#inspect(io)</code>.</p>","abstract":false,"args":[{"name":"io","external_name":"io","restriction":"IO"}],"args_string":"(io : IO) : Nil","args_html":"(io : IO) : Nil","location":{"filename":"src/d4/types.cr","line_number":39,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L39"},"def":{"name":"to_s","args":[{"name":"io","external_name":"io","restriction":"IO"}],"return_type":"Nil","visibility":"Public","body":"io << \"#{@left}-#{@right}:#{@value}\""},"external_var":false},{"html_id":"value:Int32-instance-method","name":"value","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":21,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L21"},"def":{"name":"value","return_type":"Int32","visibility":"Public","body":"@value"},"external_var":false}]},{"html_id":"d4/D4/Metadata","path":"D4/Metadata.html","kind":"class","full_name":"D4::Metadata","name":"Metadata","abstract":false,"superclass":{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/types.cr","line_number":65,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L65"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Metadata for D4 files","summary":"<p>Metadata for D4 files</p>","constructors":[{"html_id":"new(chromosomes:Hash(String,UInt32),dict_type:DictType,denominator:Float64=1.0)-class-method","name":"new","abstract":false,"args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"args_string":"(chromosomes : Hash(String, UInt32), dict_type : DictType, denominator : Float64 = 1.0)","args_html":"(chromosomes : Hash(String, UInt32), dict_type : <a href=\"../D4/DictType.html\">DictType</a>, denominator : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/d4/types.cr","line_number":70,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L70"},"def":{"name":"new","args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"visibility":"Public","body":"_ = allocate\n_.initialize(chromosomes, dict_type, denominator)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(lib_metadata:LibD4::FileMetadata)-class-method","name":"new","abstract":false,"args":[{"name":"lib_metadata","external_name":"lib_metadata","restriction":"LibD4::FileMetadata"}],"args_string":"(lib_metadata : LibD4::FileMetadata)","args_html":"(lib_metadata : LibD4::FileMetadata)","location":{"filename":"src/d4/types.cr","line_number":72,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L72"},"def":{"name":"new","args":[{"name":"lib_metadata","external_name":"lib_metadata","restriction":"LibD4::FileMetadata"}],"visibility":"Public","body":"_ = allocate\n_.initialize(lib_metadata)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"chromosome_count-instance-method","name":"chromosome_count","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":86,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L86"},"def":{"name":"chromosome_count","visibility":"Public","body":"@chromosomes.size"},"external_var":false},{"html_id":"chromosome_size(name:String)-instance-method","name":"chromosome_size","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"}],"args_string":"(name : String)","args_html":"(name : String)","location":{"filename":"src/d4/types.cr","line_number":94,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L94"},"def":{"name":"chromosome_size","args":[{"name":"name","external_name":"name","restriction":"String"}],"visibility":"Public","body":"@chromosomes[name]?"},"external_var":false},{"html_id":"chromosomes:Hash(String,UInt32)-instance-method","name":"chromosomes","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":66,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L66"},"def":{"name":"chromosomes","return_type":"Hash(String, UInt32)","visibility":"Public","body":"@chromosomes"},"external_var":false},{"html_id":"denominator:Float64-instance-method","name":"denominator","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":68,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L68"},"def":{"name":"denominator","return_type":"Float64","visibility":"Public","body":"@denominator"},"external_var":false},{"html_id":"dict_type:DictType-instance-method","name":"dict_type","abstract":false,"location":{"filename":"src/d4/types.cr","line_number":67,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L67"},"def":{"name":"dict_type","return_type":"DictType","visibility":"Public","body":"@dict_type"},"external_var":false},{"html_id":"has_chromosome?(name:String)-instance-method","name":"has_chromosome?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"}],"args_string":"(name : String)","args_html":"(name : String)","location":{"filename":"src/d4/types.cr","line_number":90,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/types.cr#L90"},"def":{"name":"has_chromosome?","args":[{"name":"name","external_name":"name","restriction":"String"}],"visibility":"Public","body":"@chromosomes.has_key?(name)"},"external_var":false}]},{"html_id":"d4/D4/QueryIterator","path":"D4/QueryIterator.html","kind":"class","full_name":"D4::QueryIterator","name":"QueryIterator","abstract":false,"superclass":{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"d4/Iterator","kind":"module","full_name":"Iterator","name":"Iterator"},{"html_id":"d4/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/query.cr","line_number":88,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L88"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"d4/Iterator","kind":"module","full_name":"Iterator","name":"Iterator"}],"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Iterator for querying D4 intervals","summary":"<p>Iterator for querying D4 intervals</p>","constructors":[{"html_id":"new(file:File,chromosome:String,start:UInt32,stop:UInt32|Nil)-class-method","name":"new","abstract":false,"args":[{"name":"file","external_name":"file","restriction":"File"},{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","external_name":"start","restriction":"UInt32"},{"name":"stop","external_name":"stop","restriction":"UInt32 | ::Nil"}],"args_string":"(file : File, chromosome : String, start : UInt32, stop : UInt32 | Nil)","args_html":"(file : <a href=\"../D4/File.html\">File</a>, chromosome : String, start : UInt32, stop : UInt32 | Nil)","location":{"filename":"src/d4/query.cr","line_number":101,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L101"},"def":{"name":"new","args":[{"name":"file","external_name":"file","restriction":"File"},{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start","external_name":"start","restriction":"UInt32"},{"name":"stop","external_name":"stop","restriction":"UInt32 | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(file, chromosome, start, stop)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"next-instance-method","name":"next","doc":"Returns the next element in this iterator, or `Iterator::Stop::INSTANCE` if there\nare no more elements.","summary":"<p>Returns the next element in this iterator, or <code>Iterator::Stop::INSTANCE</code> if there are no more elements.</p>","abstract":false,"location":{"filename":"src/d4/query.cr","line_number":126,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/query.cr#L126"},"def":{"name":"next","visibility":"Public","body":"if @done\n  return stop\nend\n\nwhile @buffer_index >= @buffer_count\n  fill_buffer\n  if @done\n    return stop\n  end\nend\n\nlib_interval = @buffer[@buffer_index]\n@buffer_index = @buffer_index + 1\n\ninterval = Interval.new(lib_interval)\n\n\nfiltered_left = Math.max(@start, interval.left)\nfiltered_right = Math.min(@stop, interval.right)\n\nif filtered_left < filtered_right\n  filtered_interval = Interval.new(filtered_left, filtered_right, interval.value)\n\n\n  if interval.right >= @stop\n    @done = true\n  end\n\n  filtered_interval\nelse\n  self.next\nend\n"},"external_var":false}]},{"html_id":"d4/D4/Writer","path":"D4/Writer.html","kind":"class","full_name":"D4::Writer","name":"Writer","abstract":false,"superclass":{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"d4/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"d4/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/d4/writer.cr","line_number":134,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L134"}],"repository_name":"d4","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"d4/D4","kind":"module","full_name":"D4","name":"D4"},"doc":"Writer class for creating D4 files","summary":"<p>Writer class for creating D4 files</p>","constructors":[{"html_id":"new(path:String)-class-method","name":"new","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/d4/writer.cr","line_number":137,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L137"},"def":{"name":"new","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(path)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(file:File)-class-method","name":"new","abstract":false,"args":[{"name":"file","external_name":"file","restriction":"File"}],"args_string":"(file : File)","args_html":"(file : <a href=\"../D4/File.html\">File</a>)","location":{"filename":"src/d4/writer.cr","line_number":141,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L141"},"def":{"name":"new","args":[{"name":"file","external_name":"file","restriction":"File"}],"visibility":"Public","body":"_ = allocate\n_.initialize(file)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"close-instance-method","name":"close","abstract":false,"location":{"filename":"src/d4/writer.cr","line_number":166,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L166"},"def":{"name":"close","visibility":"Public","body":"@file.close"},"external_var":false},{"html_id":"closed?-instance-method","name":"closed?","abstract":false,"location":{"filename":"src/d4/writer.cr","line_number":170,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L170"},"def":{"name":"closed?","visibility":"Public","body":"@file.closed?"},"external_var":false},{"html_id":"finalize-instance-method","name":"finalize","abstract":false,"location":{"filename":"src/d4/writer.cr","line_number":174,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L174"},"def":{"name":"finalize","visibility":"Public","body":"if closed?\nelse\n  close\nend"},"external_var":false},{"html_id":"set_chromosomes(chromosomes:Hash(String,UInt32),dict_type:DictType=DictType::SimpleRange,denominator:Float64=1.0)-instance-method","name":"set_chromosomes","abstract":false,"args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"args_string":"(chromosomes : Hash(String, UInt32), dict_type : DictType = DictType::SimpleRange, denominator : Float64 = 1.0)","args_html":"(chromosomes : Hash(String, UInt32), dict_type : <a href=\"../D4/DictType.html\">DictType</a> = <span class=\"t\">DictType</span><span class=\"t\">::</span><span class=\"t\">SimpleRange</span>, denominator : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/d4/writer.cr","line_number":143,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L143"},"def":{"name":"set_chromosomes","args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Hash(String, UInt32)"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"visibility":"Public","body":"@file.set_chromosomes(chromosomes, dict_type, denominator)"},"external_var":false},{"html_id":"set_chromosomes(chromosomes:Array(Tuple(String,UInt32)),dict_type:DictType=DictType::SimpleRange,denominator:Float64=1.0)-instance-method","name":"set_chromosomes","abstract":false,"args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Array(Tuple(String, UInt32))"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"args_string":"(chromosomes : Array(Tuple(String, UInt32)), dict_type : DictType = DictType::SimpleRange, denominator : Float64 = 1.0)","args_html":"(chromosomes : Array(Tuple(String, UInt32)), dict_type : <a href=\"../D4/DictType.html\">DictType</a> = <span class=\"t\">DictType</span><span class=\"t\">::</span><span class=\"t\">SimpleRange</span>, denominator : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/d4/writer.cr","line_number":147,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L147"},"def":{"name":"set_chromosomes","args":[{"name":"chromosomes","external_name":"chromosomes","restriction":"Array(Tuple(String, UInt32))"},{"name":"dict_type","default_value":"DictType::SimpleRange","external_name":"dict_type","restriction":"DictType"},{"name":"denominator","default_value":"1.0","external_name":"denominator","restriction":"Float64"}],"visibility":"Public","body":"@file.set_chromosomes(chromosomes, dict_type, denominator)"},"external_var":false},{"html_id":"write_dense_values(chromosome:String,start_position:UInt32,values:Array(Int32))-instance-method","name":"write_dense_values","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(chromosome : String, start_position : UInt32, values : Array(Int32))","args_html":"(chromosome : String, start_position : UInt32, values : Array(Int32))","location":{"filename":"src/d4/writer.cr","line_number":162,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L162"},"def":{"name":"write_dense_values","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"start_position","external_name":"start_position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"visibility":"Public","body":"@file.write_dense_values(chromosome, start_position, values)"},"external_var":false},{"html_id":"write_intervals(chromosome:String,intervals:Array(Interval))-instance-method","name":"write_intervals","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"args_string":"(chromosome : String, intervals : Array(Interval))","args_html":"(chromosome : String, intervals : Array(<a href=\"../D4/Interval.html\">Interval</a>))","location":{"filename":"src/d4/writer.cr","line_number":155,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L155"},"def":{"name":"write_intervals","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"intervals","external_name":"intervals","restriction":"Array(Interval)"}],"visibility":"Public","body":"if intervals.empty?\n  return\nend\n\n@file.seek(chromosome, intervals.first.left)\n@file.write_intervals(intervals)\n"},"external_var":false},{"html_id":"write_values(chromosome:String,position:UInt32,values:Array(Int32))-instance-method","name":"write_values","abstract":false,"args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","external_name":"position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"args_string":"(chromosome : String, position : UInt32, values : Array(Int32))","args_html":"(chromosome : String, position : UInt32, values : Array(Int32))","location":{"filename":"src/d4/writer.cr","line_number":151,"url":"https://github.com/kojix2/d4.cr/blob/c5dfc23690be23369c2b7977f8f52ddcda23ecd9/src/d4/writer.cr#L151"},"def":{"name":"write_values","args":[{"name":"chromosome","external_name":"chromosome","restriction":"String"},{"name":"position","external_name":"position","restriction":"UInt32"},{"name":"values","external_name":"values","restriction":"Array(Int32)"}],"visibility":"Public","body":"@file.write_values(chromosome, position, values)"},"external_var":false}]}]}]}})